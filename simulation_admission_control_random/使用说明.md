# 使用说明

> **本版本特性**：支持随机到达（Gamma 分布），可通过 `stochastic` 和 `seed` 参数控制。

## 快速开始

### 1. 配置参数

编辑 `config.json` 或使用自动配置脚本：

```bash
# 自动计算稳态参数（默认 95% 负载）
python update_config.py

# 指定负载比例
python update_config.py --target-ratio 0.9
```

### 2. 运行实验

```bash
# 基本运行
python experiment_runner.py

# 并行运行（推荐）
python experiment_runner.py --parallel --workers 10

# 包含 3D 实验（变化 arrival rate）
python experiment_runner.py --parallel --workers 10 --run-3d
```

### 3. 查看结果

输出目录 `output/experiment_YYYYMMDD_HHMMSS/` 包含：
- `results.csv` - 汇总数据
- `batch_history/` - 每个 s 值的时序数据
- `throughput_latency_2d.png` - throughput/latency vs s
- `timeseries_throughput_latency.png` - 时序图
- `timeseries_eviction_admission.png` - eviction/admission 时序

## 配置文件说明

```json
{
  "simulation_params": {
    "l0": 20,           // job 初始大小基础部分
    "l1": 8,            // 处理阶段数
    "B": 1000,          // GPU 容量
    "b0": 0.5,          // 服务时间常数项
    "b1": 0.01,         // 服务时间系数
    "lambda_rate": 0.48,// 到达率（自动计算）
    "admission_upper_bound": 5.1,  // 大S（自动计算）
    "stochastic": true, // 是否使用随机到达（Gamma 分布）
    "seed": 42          // 随机种子（null 表示不固定）
  },
  "initial_state": {
    "X0": [...],        // 初始状态（自动计算）
    "Qe0": 0
  },
  "experiment_params": {
    "s_min": 0,         // 小s 扫描范围
    "s_max": 5,
    "initial_step": 0.5,
    "min_steps": 100000,
    "max_steps": 100000
  }
}
```

## 随机到达 vs 确定性到达

| 参数设置 | 到达模型 | 说明 |
|---------|---------|------|
| `"stochastic": true` | Gamma(λs, 1) | 随机到达，均值=λs，方差=λs |
| `"stochastic": false` | λs | 确定性到达，无方差 |

**随机种子**：
- `"seed": 42` - 固定种子，实验可复现
- `"seed": null` - 不固定，每次运行结果不同

## 加速收敛技巧

默认的 X0 设置为稳态值，系统已经处于平衡状态，反而收敛较慢（没有明显的动态过程）。

如果想观察收敛过程或加速收敛，可以手动修改 `config.json` 中的 X0，将其中一个元素设为 0：

```json
"X0": [0, 4.59, 4.59, 4.59, 4.59, 4.59, 4.59, 4.59]
```

这样系统会从非稳态开始，可以观察到明显的收敛过程。

## 常用命令

```bash
# 更新配置
python update_config.py --target-ratio 0.9

# 快速测试（减少步数）
# 修改 config.json 中 min_steps 和 max_steps 为较小值

# 单独生成可视化
python visualization.py output/experiment_xxx/
```
