# æ ¸å¿ƒç¼–ç¨‹è§„èŒƒ

> ä¸¥æ ¼æ‰§è¡Œçš„ä»£ç è´¨é‡æ ‡å‡†å’Œæœ€ä½³å®è·µ

## å…«è£å…«è€»ç¼–ç¨‹åŸºæœ¬åŸåˆ™

1. **ä»¥æš—çŒœæ¥å£ä¸ºè€»ï¼Œä»¥è®¤çœŸæŸ¥é˜…ä¸ºè£** - ç¦æ­¢è‡†æµ‹APIè¡Œä¸ºï¼Œå¿…é¡»æŸ¥é˜…æ–‡æ¡£å’Œä»£ç ç¡®è®¤
2. **ä»¥æ¨¡ç³Šæ‰§è¡Œä¸ºè€»ï¼Œä»¥å¯»æ±‚ç¡®è®¤ä¸ºè£** - ä¸ç¡®å®šçš„å®ç°å¿…é¡»å…ˆå‘ç”¨æˆ·ç¡®è®¤ï¼Œé¿å…æ¨¡ç³Šæ“ä½œ
3. **ä»¥é»˜è®¤å¿½ç•¥ä¸ºè€»ï¼Œä»¥ä¸»åŠ¨æŠ¥å‘Šä¸ºè£** - é‡åˆ°å¼‚å¸¸ã€è­¦å‘Šã€é”™è¯¯å¿…é¡»ä¸»åŠ¨æŠ¥å‘Šï¼Œä¸å¾—é™é»˜å¿½ç•¥
4. **ä»¥éšå¼å‡è®¾ä¸ºè€»ï¼Œä»¥æ˜¾å¼éªŒè¯ä¸ºè£** - æ‰€æœ‰å‡è®¾å¿…é¡»é€šè¿‡ä»£ç éªŒè¯ï¼Œç¦æ­¢éšå¼ä¾èµ–
5. **ä»¥éšæ„ä¿®æ”¹ä¸ºè€»ï¼Œä»¥è°¨æ…è°ƒè¯•ä¸ºè£** - ä¿®æ”¹å‰å¿…é¡»ç†è§£åŸç†ï¼Œç¦æ­¢è¯•é”™å¼ç¼–ç¨‹
6. **ä»¥è¡¨é¢åº”ä»˜ä¸ºè€»ï¼Œä»¥æ·±å…¥ç†è§£ä¸ºè£** - è§£å†³é—®é¢˜å¿…é¡»æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œç¦æ­¢è¡¨é¢ä¿®è¡¥
7. **ä»¥å¤åˆ¶ç²˜è´´ä¸ºè€»ï¼Œä»¥åŸåˆ›æ€è€ƒä¸ºè£** - ç†è§£æ¯è¡Œä»£ç å«ä¹‰ï¼Œç¦æ­¢ç›²ç›®å¤åˆ¶
8. **ä»¥å­¤ç«‹å¼€å‘ä¸ºè€»ï¼Œä»¥ååŒæ²Ÿé€šä¸ºè£** - ä¸»åŠ¨æ±‡æŠ¥è¿›åº¦å’Œé—®é¢˜ï¼Œå¯»æ±‚æŒ‡å¯¼å’Œåé¦ˆ

## æ–‡ä»¶å‘½åè§„èŒƒ - ä¸¥æ ¼ç¦æ­¢

### ç¦ç”¨å‰ç¼€åç¼€åˆ—è¡¨

- âŒ `enhanced_*` / `*_enhanced` - ç¦æ­¢enhancedå‰ç¼€åç¼€
- âŒ `integrated_*` / `*_integrated` - ç¦æ­¢integratedå‰ç¼€åç¼€
- âŒ `cleaned_*` / `*_cleaned` / `*_clean` - ç¦æ­¢cleanç›¸å…³å‘½å
- âŒ `improved_*` / `*_improved` - ç¦æ­¢improvedå‰ç¼€åç¼€
- âŒ `optimized_*` / `*_optimized` - ç¦æ­¢optimizedå‰ç¼€åç¼€
- âŒ `advanced_*` / `*_advanced` - ç¦æ­¢advancedå‰ç¼€åç¼€
- âŒ `*_v2` / `*_new` / `*_old` / `*_temp` - ç¦æ­¢ç‰ˆæœ¬å’Œä¸´æ—¶æ ‡è¯†ç¬¦

### æ­£ç¡®å‘½ååŸåˆ™

- âœ… **åŠŸèƒ½å¯¼å‘å‘½å** - ç›´æ¥æè¿°æ–‡ä»¶åŠŸèƒ½ï¼š`multi_type_simulator.py`ã€`experiment_runner.py`
- âœ… **æ¨¡å—åŒ–å‘½å** - æŒ‰æ¨¡å—ç»„ç»‡ï¼š`visualization.py`ã€`stability_detector.py`
- âœ… **ç®€æ´æ˜ç¡®** - é¿å…å†—ä½™å½¢å®¹è¯ï¼Œç›´æ¥è¡¨è¾¾æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç»Ÿä¸€é£æ ¼** - ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼Œå…¨å°å†™å­—æ¯

### å‘½åç¤ºä¾‹å¯¹æ¯”

```bash
# âŒ é”™è¯¯å‘½å
enhanced_multi_type_simulator.py  â†’  # âœ… multi_type_simulator.py
experiment_runner_integrated.py    â†’  # âœ… experiment_runner.py
visualize_clean.py                 â†’  # âœ… visualization.py
stable_condition_v2.py             â†’  # âœ… stable_condition.py
```

## é”™è¯¯å¤„ç†å¼ºåˆ¶è§„èŒƒ

```python
# âŒ ä¸¥æ ¼ç¦æ­¢çš„fallbackæ¨¡å¼
try:
    result = complex_operation()
except Exception:
    result = fallback_operation()  # ç¦æ­¢ï¼

# âŒ ä¸¥æ ¼ç¦æ­¢çš„å±æ€§æ£€æŸ¥fallback
if hasattr(obj, 'attribute'):
    return obj.attribute
else:
    return default_value  # ç¦æ­¢ï¼

# âœ… æ­£ç¡®çš„é”™è¯¯å¤„ç†æ–¹å¼
result = complex_operation()  # è®©é”™è¯¯è‡ªç„¶æŠ›å‡º
required_attribute = obj.attribute  # ç›´æ¥è®¿é—®ï¼Œç¼ºå¤±æ—¶æŠ¥é”™
```

### æ ¸å¿ƒè¦æ±‚

- ğŸ”¥ **ç¦æ­¢ä½¿ç”¨try except** - ç¢°è§é”™è¯¯ç›´æ¥æ˜¾ç¤ºtracebackå¹¶é€€å‡ºç»ˆæ­¢è¿è¡Œç¨‹åº
- ğŸ”¥ **ç¦æ­¢é‡‡ç”¨fallbackæ–¹æ¡ˆ** - å¦‚ç¼ºå°‘å±æ€§ç›´æ¥æŠ¥é”™è¿”å›ï¼Œä¸å…è®¸é™çº§å¤„ç†
- âœ… **è®©é”™è¯¯è‡ªç„¶æŠ›å‡º** - ä¾¿äºä»æœ¬è´¨ä¸Šè§£å†³é—®é¢˜ï¼Œè€Œéæ©ç›–é—®é¢˜

## æ¨¡å—æ–‡æ¡£å¼•ç”¨è§„èŒƒ - å¼ºåˆ¶æ‰§è¡Œ

### æ ¸å¿ƒåŸåˆ™

æ¯ä¸ª Python æ¨¡å—å¿…é¡»åœ¨æ–‡ä»¶å¼€å¤´æ˜ç¡®æŒ‡å‘å¯¹åº”çš„æ–‡æ¡£

### æ¨¡å—å¤´éƒ¨æ¨¡æ¿

```python
"""
[æ¨¡å—ç®€çŸ­æè¿° - ä¸€å¥è¯è¯´æ˜æ¨¡å—åŠŸèƒ½]

Documentation:
    Interface: docs/modules/[module_name].md
    Theoretical Basis: /path/to/Overleaf/LLM_serving/[related_tex_file].tex
    Related Paper Section: [Section X.X - Theorem/Lemma name]

Key Features:
    - Feature 1: Brief description
    - Feature 2: Brief description
    - Feature 3: Brief description

Dependencies:
    - numpy: Numerical computations
    - module_a: Purpose

Mathematical Correspondence:
    - State X_n: Corresponds to self.state in code
    - Arrival rate Î»: self.arrival_rates parameter
    - Memory capacity B: self.B parameter

Example:
    >>> from multi_type_simulator import MultiTypeLLMSimulator
    >>> sim = MultiTypeLLMSimulator(request_type_list=[(2,5), (5,2)], B=50, ...)
    >>> sim.run(100)
"""

import numpy as np
# ... rest of imports
```

### é’ˆå¯¹æœ¬é¡¹ç›®çš„ç‰¹å®šè¦æ±‚

#### 1. æ¨¡æ‹Ÿå™¨æ¨¡å— (å¦‚ `multi_type_simulator.py`)

```python
"""
Multi-Type LLM Request Scheduling Simulator with Decode Priority

Documentation:
    Implementation: new_project_for_multi_type/README.md
    Theoretical Basis: /Users/ruicheng/Library/.../LLM_serving/multiple_discrete.tex
    Related Theorem: Theorem 2 (GCD Stability Condition)

Key Features:
    - Decode priority scheduling (priority = current_length - l0)
    - n-proportional eviction by type
    - Overloaded system assumption (Z = B)
    - Complete history recording

Mathematical Correspondence:
    - X[length][type]: State variable from multiple_discrete.tex
    - l0, l1: Prompt and decoding lengths
    - B: Memory capacity
    - Î» (lambda): Arrival rates
"""
```

#### 2. å®éªŒè¿è¡Œå™¨ (å¦‚ `experiment_runner.py`)

```python
"""
Batch Experiment Runner for Admission Control Policy Testing

Documentation:
    Implementation: simulation_admission_control/README.md (if exists)
    Theoretical Basis: admission_control.tex
    Related Policy: Rate-limited admission control

Key Features:
    - Multiprocessing for parallel experiments
    - Parameter sweeping (admission threshold range)
    - Stability detection
    - Automatic result aggregation
"""
```

#### 3. æ•°å­¦åˆ†æå·¥å…· (å¦‚ `stable_condition.py`)

```python
"""
Stability Manifold Analysis and Phase Space Visualization

Documentation:
    Theoretical Basis: single_discrete.tex (lines 52-140)
    Related: Eigenvalue analysis of PoincarÃ© map P^(i)

Key Features:
    - Root finding for characteristic polynomial
    - Eigen-decomposition for stable manifold
    - 3D phase space trajectory plotting

Mathematical Correspondence:
    - Matrix B_1, B_2^(i): No-eviction and eviction operators
    - P^(i): Full cycle PoincarÃ© map
    - Eigenvalues: Stability analysis
"""
```

### æ£€æŸ¥æ¸…å•ï¼ˆæäº¤ä»£ç å‰ï¼‰

- [ ] æ¨¡å—å¼€å¤´åŒ…å« docstring
- [ ] Documentation éƒ¨åˆ†åˆ—å‡ºç›¸å…³æ–‡æ¡£å’Œç†è®ºæ–‡ä»¶
- [ ] å¦‚æ¶‰åŠç†è®ºéªŒè¯ï¼Œæ˜ç¡®æŒ‡å‡ºå¯¹åº”çš„texæ–‡ä»¶å’Œå®šç†
- [ ] Key Features åˆ—å‡ºæ ¸å¿ƒåŠŸèƒ½ï¼ˆ3-5æ¡ï¼‰
- [ ] Mathematical Correspondence åˆ—å‡ºä»£ç å˜é‡ä¸æ•°å­¦ç¬¦å·çš„å¯¹åº”
- [ ] Example æä¾›åŸºæœ¬ç”¨æ³•ç¤ºä¾‹

## è„šæœ¬ç»„ç»‡å’Œæ¨¡å—åŒ–è§„èŒƒ

### è„šæœ¬å¤æ‚åº¦æ§åˆ¶

- âœ… **ç®€å•è„šæœ¬**: ç›´æ¥åœ¨scripts/ä¸­å®ç°ï¼Œæœ€å¤š50è¡Œ
- âœ… **å¤æ‚é€»è¾‘**: å¿…é¡»åˆ†ç¦»åˆ°ç‹¬ç«‹æ¨¡å—ä¸­ï¼Œè„šæœ¬ä»…åšè°ƒç”¨
- âŒ **ç¦æ­¢å†…åµŒ**: ä¸¥ç¦åœ¨è„šæœ¬ä¸­å†™å¤§æ®µPythonä»£ç æˆ–å‡½æ•°
- âŒ **ç¦æ­¢é‡å¤**: ç›¸åŒé€»è¾‘ä¸å¾—åœ¨å¤šä¸ªè„šæœ¬ä¸­é‡å¤å®ç°

### æ¨¡å—åŒ–åˆ†ç¦»åŸåˆ™

```bash
# âŒ é”™è¯¯åšæ³•ï¼šåœ¨è„šæœ¬ä¸­å†…åµŒå¤æ‚é€»è¾‘
run_experiment.sh:
    python -c "
    import complex_logic
    # 50è¡Œå¤æ‚ä»£ç ...
    "

# âœ… æ­£ç¡®åšæ³•ï¼šåˆ†ç¦»åˆ°æ¨¡å—
multi_type_simulator.py:        # å¤æ‚é€»è¾‘åœ¨ç‹¬ç«‹æ¨¡å—
    class MultiTypeLLMSimulator: ...

run_simulation.py:              # Pythonè„šæœ¬è°ƒç”¨æ¨¡å—
    from multi_type_simulator import MultiTypeLLMSimulator
    sim = MultiTypeLLMSimulator(...)
    sim.run(steps)

run_sim.sh:                     # Bashè„šæœ¬ä»…ä¼ å‚
    python run_simulation.py --B $B --steps $STEPS
```

### è„šæœ¬èŒè´£è¾¹ç•Œ

- **scripts/** (å¦‚ `run_sim.sh`): å‚æ•°ä¼ é€’ã€æµç¨‹æ§åˆ¶ã€çŠ¶æ€æ£€æŸ¥
- **æ¨¡å—** (å¦‚ `multi_type_simulator.py`): æ ¸å¿ƒç®—æ³•ã€æ•°æ®å¤„ç†ã€å¤æ‚é€»è¾‘
- **configs/**: å‚æ•°é…ç½®ã€è¶…å‚æ•°è®¾å®š

## ä¸´æ—¶æ–‡ä»¶ç®¡ç†è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™

ä¸´æ—¶æµ‹è¯•æ–‡ä»¶å¿…é¡»åœ¨ `tmp/` ç›®å½•ï¼Œä½¿ç”¨åç«‹å³åˆ é™¤

### é€‚ç”¨åœºæ™¯

- âœ… å¿«é€ŸéªŒè¯æŸä¸ªåŠŸèƒ½
- âœ… è°ƒè¯•ä»£ç ç‰‡æ®µ
- âœ… ä¸´æ—¶æ€§èƒ½æµ‹è¯•
- âœ… ä¸€æ¬¡æ€§æ•°æ®æ¢ç´¢

### ç¦æ­¢åœºæ™¯

- âŒ æ­£å¼çš„å•å…ƒæµ‹è¯• â†’ åº”æ”¾åœ¨ `tests/`
- âŒ ç¤ºä¾‹ä»£ç  â†’ åº”æ”¾åœ¨ `demo/` æˆ–æ–‡æ¡£ä¸­
- âŒ å®éªŒè„šæœ¬ â†’ åº”æ”¾åœ¨ `experiments/`

### ä½¿ç”¨è§„èŒƒ

```bash
# 1. åˆ›å»ºä¸´æ—¶æµ‹è¯•æ–‡ä»¶
tmp/test_stability.py
tmp/debug_eviction.py

# 2. æµ‹è¯•å®Œæˆåç«‹å³åˆ é™¤
rm tmp/test_stability.py

# 3. gitå·²é…ç½®å¿½ç•¥tmp/ç›®å½•
```

### å¼ºåˆ¶è¦æ±‚

- ğŸš« **ç¦æ­¢æäº¤åˆ°git**: tmp/ç›®å½•å¿…é¡»åœ¨.gitignoreä¸­
- ğŸš« **ç¦æ­¢é•¿æœŸä¿ç•™**: æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸ â‰¤ 1å¤©
- ğŸš« **ç¦æ­¢ä¾èµ–å…³ç³»**: ä»»ä½•æ­£å¼ä»£ç ä¸å¾—import tmp/ä¸­çš„æ–‡ä»¶
- âœ… **é¼“åŠ±å³æµ‹å³åˆ **: æµ‹è¯•å®Œæˆåç«‹å³æ¸…ç†

---

**ç›¸å…³æ–‡æ¡£**:
- [æ–‡ä»¶ç»„ç»‡è§„èŒƒ](file_organization.md)
- [å®éªŒå¯é‡å¤æ€§](experiment_reproducibility.md)
- [æ—¥å¸¸å¼€å‘å‚è€ƒ](daily_reference.md)
